<ion-header [translucent]="true" class="shadow-none">
  <ion-toolbar>
    <ion-chip (click)="modalService.dismiss(this.ventes_to_view)">
      <i class="bi bi-x-circle me-1"></i>
      <ion-label>Fermer</ion-label>
    </ion-chip>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" class="vente-detail-content ion-padding">

  <!-- Section entête -->
  <div class="header-card bg-white rounded rounded-4 p-2 text-center">
    <h2 class="text-primary-base fw-bold">Vente #{{ ventes_to_view?.id }}</h2>
    <p class="vente-date">
      <i class="bi bi-calendar-event me-1"></i>
      {{ ventes_to_view?.date | date:'d MMMM yyyy' }} à {{ ventes_to_view?.created_at | date:'HH:mm' }}
    </p>
    <p class="vente-client">
      <i class="bi bi-person me-1"></i>
      {{ ventes_to_view?.client?.nom_client || 'Client inconnu' }}
    </p>

    <div class="d-flex justify-content-between align-items-center">
      <ion-badge
        [ngClass]="ventes_to_view?.etat_vente?.id === 1 ? 'text-success-emphasis bg-success-subtle' : 'text-danger-emphasis bg-danger-subtle'">
        {{ ventes_to_view?.etat_vente?.libelle_etat_vente || 'En attente' }}
      </ion-badge>
      <ion-badge class="text-success-emphasis bg-success-subtle">
        {{ getTotal(ventes_to_view?.detail_ventes) | number:'':'fr' }} FCFA
      </ion-badge>
    </div>
  </div>

  <!-- Liste des produits -->
  <ion-list class="rounded rounded-3 bg-transparent">
    <span class="fs-5">Produits</span>
    <ng-container *ngIf="ventes_to_view?.detail_ventes?.length;">
      @for (detail of ventes_to_view.detail_ventes; track $index) {
      <ion-item class="header-card bg-white rounded rounded-4 mb-2">
        <ion-label class="ion-text-wrap">
          <h4 class="fw-bold text-primary-base">{{ detail.produit?.libelle_produit || 'Produit inconnu' }}</h4>
          <p>Quantité : <strong>{{ detail.quantite }}</strong></p>
          <p>Prix unitaire : {{ detail.prix_unitaire | number:'':'fr' }} FCFA</p>
          <p>Entrepôt : {{ detail.rangement?.entrepot?.libelle_entrepot || 'N/A' }}</p>
          <p>Rangement : {{ detail.rangement?.libelle_rangement || '-' }}</p>
        </ion-label>
        <p class="text-primary-base">
          {{ (detail.quantite * detail.prix_unitaire) | number:'':'fr' }} FCFA
        </p>
      </ion-item>
      }
    </ng-container>
  </ion-list>
  <app-acomptes [seletected_vente]="ventes_to_view"></app-acomptes>
  <!-- Boutons d'action -->
  <!-- <div class="d-flex justify-content-between w-75 m-auto">
    <ion-button fill="outline" color="medium">
      <i class="bi bi-file-earmark-text me-1"></i> Facture
    </ion-button>
    <ion-button fill="outline" color="medium">
      <i class="bi bi-printer me-1"></i> Ticket
    </ion-button>
  </div> -->

  <!-- IonFab -->
  <ion-fab horizontal="end" vertical="bottom" slot="fixed">
    <ion-fab-button style="--background:var(--base-color);">
      <i class="bi bi-info-circle fs-4"></i>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button style="--background:var(--base-color);--color:white" (click)="openModal_add_acomptes()">
        <i class="bi bi-plus-square-dotted"></i>
      </ion-fab-button>
      <ion-fab-button style="--background:var(--base-color);--color:white" (click)="openModal_edit_ventes()">
        <i class="bi bi-pencil-square"></i>
      </ion-fab-button>
      <ion-fab-button style="--background:var(--base-color);--color:white">
        <i class="bi bi-printer"></i>
      </ion-fab-button>
      <ion-fab-button style="--background:var(--base-color);--color:white">
        <i class="bi bi-file-earmark-text"></i>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>
